<!DOCTYPE html>

<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Método Simplex</title>
	<script src = "LPdefs.js"></script>
	<script src = "LPmethods.js"></script>
	<script>
		lp_reportErrorsTo=lp_reportSolutionTo="solutionout";
		var lp_demo_exampleNumber=0;
		var lp_demo_accuracy=6;
		var lp_demo_mode="decimal";
		var lp_demo_verboseLevel=lp_verbosity_none;
		var exampleStr = [
		"Maximize p = (1/2)x + 3y + z + 4w subject to \nx + y + z + w <= 40\n2x + y - z - w >= 10\nw - y >= 12"
		,
		"minimize z = 900x1 + 1400x2 + 700x3 + 1000x4 + 1700x5 + 900x6 subject to\nx1 + x2 + x3 <= 10\nx4 + x5 + x6 <= 10\nx1 + x4 >= 6\nx2 + x5 >= 4\nx3 + x6 >= 4\nx4 - x6 <= 0"
		,
		
		"Maximize p = (1/2)x + 3y + z + 4w subject to \nx + y + z + w <= 40 \n2x + y - z - w >= 10 \nw - y >= 12 \ninteger w, x, y, z"
		,
		"Maximize p = x + 2y + 3z subject to \nx + y <= 20.5\ny + z <= 20.5\nx + z <= 30.5\ninteger x, y, z" ,
		"Maximize p = x+y\nx+y<=.75\nx+y>=.5\ninteger x,y"]

		function showExamples() {
			document.getElementById("inputarea").value=exampleStr[lp_demo_exampleNumber%exampleStr.length];
			lp_demo_exampleNumber++;
		}

		function clearAll() {
			document.getElementById("inputarea").value="";
			document.getElementById("solutionout").innerHTML="Una solución óptima (o mensaje) aparecerá aquí.";
			document.getElementById("outputarea").innerHTML="Las tablas del Método Simplex apareceran aquí.";
		}

		function clearOutput() {
			document.getElementById("outputarea").innerHTML="Las tablas del Método Simplex apareceran aquí.";
		}
		
		function showOutput( str ) {
			document.getElementById("outputarea").innerHTML = str;
		}
		
		function showSolution( str ) {
			document.getElementById("solutionout").innerHTML = str;
			//console.log(str); este seria el lo que me da z y x1, x2
		}

		/*
		Utilizar estas restricciones
		5x1 + 8x2 <= 90
		x2 <= 40
		*/
		// FILA DEL Z (Muestra los costo de oportunidad y la slack)
		function showFilaZ( filafinalZ) {
			var posicion = filafinalZ.length; //tamaño
			var mostrar = filafinalZ[posicion-1]; // me devuelve el ultima fila
			var cOportrunidad = "";
			var slack = "";
			var cantidadVariable = 2; // cuando tengamos el id de la cantidad de variables se le puede colocar aca
			for (var i=1; i < ((mostrar.length) -2); i++){
				if(i<= cantidadVariable){
				cOportrunidad = cOportrunidad + "Producto "+[i]+":"+" "+ mostrar[i] + "<br>";
				}else{
				slack = slack +" "+ mostrar[i] + "<br>";
				}
			}
				
			document.getElementById("costoOportunidad").innerHTML = cOportrunidad;
			document.getElementById("valorSlack").innerHTML = slack;
		}

		function adjustAccuracy() {
			var inAcc=parseInt(document.getElementById("accuracyDig").value);
			if ( (inAcc<=0)||(inAcc>13)||(isNaN(inAcc)) ) {
				alert("Must be in integer in the range 0-13")
				document.getElementById("accuracyDig").value=6;
			}
			else lp_demo_accuracy = inAcc;
		}

		function setMode() {
			lp_demo_mode=parseInt(document.querySelector('input[name="modepicker"]:checked').id); // ids are conveniently set to equal the mode
		}

		function setShowTabl() {
			var theId = document.querySelector('input[name="displaytabl"]:checked').id;
			switch ( theId ) {
				case "yesTabl":		lp_demo_verboseLevel = lp_verbosity_tableaus; break;
				case "andSolns":	lp_demo_verboseLevel = lp_verbosity_solutions; break;
				default:			lp_demo_verboseLevel = lp_verbosity_none; break;
			}
// 			lp_demo_verboseLevel = (theId=="yesTabl") ? lp_verbosity_tableaus : lp_verbosity_none;
		}
	</script>
</head>

<body class="bg-light">

		<div id="info1" class="py-5 text-center">
			<h2>Método simplex</h2>
			<p class="lead"> Escriba su problema de programacion lineal. (Presione "Ejemplos" para pasar por algunos problemas ya configurados). Luego presione "Resolver".
			</p>
		</div>
		<center>
			<div id="input">
				<form id="formulario">
					<div class="col-md-3 mb-3">
						¿Qué desea hacer?
						<select class="custom-select d-block w-100" id="objetivo">
						<option	value ="Maximizar">Maximizar</option>
						<option value="Minimizar">Minimizar</option>
						</select>
					</div>
					<div class="col-md-3 mb-3">
						<label for="funcion">Función: </label>
						<input class="form-control" id="funcion" type="text" size="20">
					</div>
					<div class="col-md-3 mb-3">
						<label for="cantVariable">¿Cuantas variables de decisión tiene el problema? </label>
						<input class="form-control" id="cantVariable" type="text" size="20">
					</div>	
					<div class="col-md-3 mb-3">
						<label for="cantRestriccion">¿Cuantas restricciones? </label>
						<input class="form-control" id="cantRestriccion" type="text" size="20">
					</div>	
					
						<button type="button" class="btn btn-outline-info"  onClick="CrearRelleno();">Aceptar</button>			
						<p></p>
						
					
				</form>
				<form class="form-inline" id="cosas">		
				</form>
			</div>
			<p>
				Costo de oportunidad :
			<div id="costoOportunidad"></div>
			</p>

			<p>
				Valor marginal :
				<div id="valorSlack"></div>
			</p>

			</div>
			<div id="info2" style="width:100%;text-align:center;margin:5px 0 5px 0">
				Solución:
			</div>
			<div id="solutionout" style="text-align:left;background-color:white;width:95%;font-family:monospace;border:thin solid;padding:10px">
				Una solución óptima (o mensaje) aparecerá aquí.
			</div>
			<div id="buttonsdiv" style="width:100%;text-align:center;margin:5px 0 5px 0">
					<button class="btn btn-primary" onClick="Resolv();">Resolver</button>
					&#160; &#160;
					<button class="btn btn-secondary" onClick="clearAll();">Borrar todo</button>
				
				<br>&#160;<br>
				
				<div style="display: inline-block; vertical-align:middle; text-align:left">
					<div class="custom-control custom-radio">
					<input type="radio" name="displaytabl" id="noTabl" class="custom-control-input"> 
					<label class="custom-control-label" for="noTabl">Ocultar las tablas. </label>
					</div>
					<div class="custom-control custom-radio">
					<input class="custom-control-input" type="radio" checked="true" name="displaytabl" id="yesTabl"> 
					<label class="custom-control-label" for="yesTabl">Mostrar las tablas (pasos).</label>
					</div>
					<div class="custom-control custom-radio">
					<input class="custom-control-input" type="radio" name="displaytabl" id="andSolns"> 
					<label class="custom-control-label" for="andSolns">Mostrar tablas y soluciones intermedias.</label>
					</div>
				</div>
				&#160; &#160; 
				Modo Tabla: <div style="display: inline-block; vertical-align:middle; text-align:left">
					<div class="custom-control custom-radio">
					<input type="radio" checked="true" name="modepicker" id="3" value="decimal" class="custom-control-input">
					<label class="custom-control-label" for="3">decimal </label>
					</div>
					<div class="custom-control custom-radio">
					<input class="custom-control-input" type="radio" name="modepicker" id="2" value="fraction" class="custom-control-input">
					<label class="custom-control-label" for="2">fracción</label>
					</div>
					<div class="custom-control custom-radio">
					<input class="custom-control-input" type="radio" name="modepicker" id="1" value="integer" class="custom-control-input">
					<label class="custom-control-label" for="1">entero</label>
					</div>
				</div>
					&#160; &#160;

				 Redondeo: <input type="text" id="accuracyDig" size="1" value="6"> dígitos significativos
					&#160; &#160;
			</div>
			<div id="outputarea" style="width: 95%; overflow-x: scroll; background-color:white; font-family:monospace; border: thin solid; padding: 10px; text-align:left">
				Las tablas del Método Simplex apareceran aquí.
			</div>
			<div id="spacer" style="height:20px"></div>
		</center>

	<script>
	function Resolv() {
		var ob = document.getElementById("objetivo").value; //variable ob toma el valor del cuadro de texto objetivo
		var f = document.getElementById("funcion").value; //variable f toma el valor del cuadro de texto funcion
		var r = document.getElementById("restriccion").value; //variable r toma el valor del cuadro de texto restriccion

		var ArrayFormateado;
		const subject = " subject to ";

		
		if (ob == "Maximizar"){
			ob = "Maximize ";
		}else{
			ob = "minimize ";
		}

	ArrayFormateado = `${ob}${f}${subject}${r}`; //arrayformateado guarda los datos del problema, separados
	console.log({ArrayFormateado});
	clearOutput();
					adjustAccuracy();setMode();setShowTabl();
					var Q = new lpProblem( ArrayFormateado); //crea un objeto lpProblem a partir de arrayformateado
					lp_verboseLevel=lp_demo_verboseLevel;
					Q.mode=lp_demo_mode;
					Q.sigDigits=lp_demo_accuracy;
					try{Q.solve()} //acá llama a solve para el problema
					finally{showOutput( lp_trace_string );showSolution( Q.solutionToString() ); showFilaZ(filaZ)} //muestra la solución como string, también los pasos intermedios
	}
	
	function CrearRelleno(){
		var cantidadVariable = document.getElementById("cantVariable").value;
		var cantidadRestricciones= document.getElementById("cantRestriccion").value;
		var rellenoV = "";
		
	
		for (var i = 1; i <= (cantidadRestricciones) ; i++) {//filas
			
			rellenoV += ' <div class="form-group row">';
			for (var j = 1; j <= (cantidadVariable) ; j++) {//colmunas
				rellenoV += `<input type="text" class="form-control" > 
								 x`+[j]+' + ';
				
			}
			
			rellenoV = rellenoV.slice(0,-2); //dame todo el string menos el ultimo caracter
			rellenoV += ` <select class="custom-select d-block w-20"  id="opcion">
						<option	value ="menor_igual">≤</option>
						<option value="mayor_igual">≥</option>
						<option value="igual">=</option>
						</select>
						<input type="text" class="form-control" >`;

			rellenoV += '</div>';
		}

	
		document.getElementById("cosas").innerHTML = rellenoV;

	}
	</script>
	<style>
		#cosas {
			
			margin: 0 auto;

			display: inline-block;
			
		}
				
	</style>
</body>
</html>
